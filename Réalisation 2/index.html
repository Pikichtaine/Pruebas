<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ejemplo — Lista de productos con filtrado</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#6ee7b7;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; min-height:100vh; background:linear-gradient(180deg,#071024 0%, var(--bg) 100%); color:#e6eef8}
    .wrap{max-width:1100px;margin:36px auto;padding:20px}

    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:700;color:#05202a}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .controls{display:flex;gap:12px;flex-wrap:wrap;margin:18px 0}
    .controls input[type=text], .controls select{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:10px 12px;border-radius:10px;color:inherit;min-width:160px}
    .controls .stretch{flex:1;min-width:220px}

    .stats{color:var(--muted);font-size:13px;margin-bottom:8px}

    /* grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:8px}
    .imgwrap{height:140px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);border-radius:10px}
    .imgwrap img{max-height:120px;max-width:100%;object-fit:contain}
    .title{font-size:14px;font-weight:600}
    .cat{font-size:12px;color:var(--muted)}
    .price{margin-top:auto;font-weight:700}

    .empty{padding:28px;text-align:center;color:var(--muted);background:rgba(255,255,255,0.02);border-radius:10px}

    footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}

    @media (max-width:600px){header{flex-direction:column;align-items:flex-start}.controls{gap:8px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">PD</div>
        <div>
          <h1>Catálogo de productos</h1>
          <p class="lead">Ejemplo: consume JSON, muestra tarjetas y permite filtrar/buscar</p>
        </div>
      </div>
      <div style="text-align:right;color:var(--muted)">
        <div id="updated">Cargando...</div>
      </div>
    </header>

    <div class="controls">
      <input id="search" class="stretch" type="text" placeholder="Buscar por nombre..." autocomplete="off">
      <select id="category">
        <option value="all">Todas las categorías</option>
      </select>
      <select id="sort">
        <option value="default">Orden: Predeterminado</option>
        <option value="price-asc">Precio ↑</option>
        <option value="price-desc">Precio ↓</option>
        <option value="title-asc">Nombre A→Z</option>
      </select>
    </div>

    <div class="stats"><span id="count"></span></div>

    <main>
      <div id="grid" class="grid"></div>
      <div id="empty" class="empty" style="display:none">No se encontraron productos.</div>
    </main>

    <footer>Datos obtenidos desde <a href="https://fakestoreapi.com" target="_blank" style="color:var(--accent)">FakeStoreAPI</a>. Guarda este archivo como <code>index.html</code> y ábrelo en tu navegador.</footer>
  </div>

  <script>
    // URL de la API pública de ejemplo
    const API = 'https://fakestoreapi.com/products';

    // Estado local
    let PRODUCTS = [];
    let filtered = [];

    // Elementos
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const search = document.getElementById('search');
    const category = document.getElementById('category');
    const sort = document.getElementById('sort');
    const count = document.getElementById('count');
    const updated = document.getElementById('updated');

    // Fetch inicial
    fetch(API)
      .then(r => r.json())
      .then(data => {
        PRODUCTS = data;
        updated.textContent = `Última carga: ${new Date().toLocaleString()}`;
        populateCategories(PRODUCTS);
        applyFilters();
      })
      .catch(err => {
        updated.textContent = 'Error al cargar datos';
        grid.innerHTML = '<div class="empty">No se pudo obtener la lista. Revisa la consola.</div>';
        console.error(err);
      });

    // Poblamos select de categorías (dinámico)
    function populateCategories(items){
      const cats = Array.from(new Set(items.map(i=>i.category))).sort();
      cats.forEach(c=>{
        const opt = document.createElement('option'); opt.value = c; opt.textContent = capitalize(c);
        category.appendChild(opt);
      });
    }

    // Render
    function render(items){
      grid.innerHTML = '';
      if(!items.length){ empty.style.display='block'; count.textContent = '0 productos'; return }
      empty.style.display='none';
      count.textContent = `${items.length} producto${items.length>1?'s':''}`;

      items.forEach(p=>{
        const card = document.createElement('article'); card.className='card';
        card.innerHTML = `
          <div class="imgwrap"><img src="${p.image}" alt="${escapeHtml(p.title)}"></div>
          <div class="title">${escapeHtml(p.title)}</div>
          <div class="cat">${capitalize(p.category)}</div>
          <div class="price">€${Number(p.price).toFixed(2)}</div>
        `;
        grid.appendChild(card);
      })
    }

    // Filtrado + búsqueda + orden
    function applyFilters(){
      const q = search.value.trim().toLowerCase();
      const cat = category.value;
      const s = sort.value;

      filtered = PRODUCTS.filter(p=>{
        const matchQ = p.title.toLowerCase().includes(q) || p.description.toLowerCase().includes(q);
        const matchCat = (cat === 'all') ? true : p.category === cat;
        return matchQ && matchCat;
      });

      if(s === 'price-asc') filtered.sort((a,b)=>a.price-b.price);
      else if(s === 'price-desc') filtered.sort((a,b)=>b.price-a.price);
      else if(s === 'title-asc') filtered.sort((a,b)=>a.title.localeCompare(b.title));

      render(filtered);
    }

    // Small utilities
    function capitalize(str){ return String(str).replace(/(^|\s)\S/g, t=>t.toUpperCase()) }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]) }

    // Debounce helper for search input
    function debounce(fn, ms=250){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms) } }

    // Event listeners
    search.addEventListener('input', debounce(applyFilters, 220));
    category.addEventListener('change', applyFilters);
    sort.addEventListener('change', applyFilters);

    // Accessibility: keyboard focus on search at load
    window.addEventListener('load', ()=>search.focus());
  </script>
</body>
</html>
